const { expect } = require("chai");

const Deployer = artifacts.require("Deployer");
const Liquidator = artifacts.require("Liquidator");

const BYTECODE =
  "0x60806040523480156200001157600080fd5b50600080546001600160a01b03191673f1c73bb23934127a2c1fa4ba7520822574fe9ba717905562000057733d9819210a31b4961b30ef54be2aed79b9c9cd3b6200005d565b62000253565b600280546001600160a01b0319166001600160a01b038316908117909155604080516307dc0d1d60e41b81529051637dc0d1d091600480820192602092909190829003018186803b158015620000b257600080fd5b505afa158015620000c7573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190620000ed91906200020a565b600380546001600160a01b0319166001600160a01b039283161790556002546040805163743aaa2360e11b81529051919092169163e8755446916004808301926020929190829003018186803b1580156200014757600080fd5b505afa1580156200015c573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906200018291906200023a565b600490815560025460408051634ada90af60e01b815290516001600160a01b0390921692634ada90af928282019260209290829003018186803b158015620001c957600080fd5b505afa158015620001de573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906200020491906200023a565b60055550565b6000602082840312156200021c578081fd5b81516001600160a01b038116811462000233578182fd5b9392505050565b6000602082840312156200024c578081fd5b5051919050565b61355680620002636000396000f3fe6080604052600436106100e15760003560e01c80638bad38dd1161007f578063b71da2e411610059578063b71da2e414610240578063d6ea53b114610260578063d986c54f14610280578063ecc28373146102a0576100e8565b80638bad38dd146101e05780639214db2314610200578063a6f9dae114610220576100e8565b806341c0e1b5116100bb57806341c0e1b51461014f5780635fe3b567146101645780637dc0d1d0146101a057806380ee2e2f146101c0576100e8565b806310d1e85c146100ed578063117de2fd1461010f578063398fc08c1461012f576100e8565b366100e857005b600080fd5b3480156100f957600080fd5b5061010d610108366004612f50565b6102c0565b005b34801561011b57600080fd5b5061010d61012a366004612f25565b610a8d565b34801561013b57600080fd5b5061010d61014a366004612fe1565b610b66565b34801561015b57600080fd5b5061010d610bea565b34801561017057600080fd5b50600254610184906001600160a01b031681565b6040516001600160a01b03909116815260200160405180910390f35b3480156101ac57600080fd5b50600354610184906001600160a01b031681565b3480156101cc57600080fd5b5061010d6101db3660046131b5565b610c3e565b3480156101ec57600080fd5b5061010d6101fb366004612e9d565b610e0d565b34801561020c57600080fd5b5061010d61021b366004612ed5565b610e5f565b34801561022c57600080fd5b5061010d61023b366004612e9d565b610ec7565b34801561024c57600080fd5b5061010d61025b366004612e9d565b610f3c565b34801561026c57600080fd5b5061010d61027b366004612e9d565b610fd6565b34801561028c57600080fd5b5061010d61029b366004612ed5565b61104b565b3480156102ac57600080fd5b5061010d6102bb366004612fe1565b6114e0565b60006102ce828401846130d5565b90506000336001600160a01b0316630dfe16816040518163ffffffff1660e01b815260040160206040518083038186803b15801561030b57600080fd5b505afa15801561031f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103439190612eb9565b90506000336001600160a01b031663d21220a76040518163ffffffff1660e01b815260040160206040518083038186803b15801561038057600080fd5b505afa158015610394573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103b89190612eb9565b90506103d9735c69bee701ef814a2b6a3edd4b1652cb9cc5aa6f83836115c0565b6001600160a01b0316336001600160a01b03161461043e5760405162461bcd60e51b815260206004820152601160248201527f4861636b6572206e6f206861636b696e6700000000000000000000000000000060448201526064015b60405180910390fd5b6001600160a01b03821673c02aaa39b223fe8d0a0e5c4f27ead9083c756cc21415610467578091505b8251600314156105875773c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2632e1a7d4d610495888a613439565b6040518263ffffffff1660e01b81526004016104b391815260200190565b600060405180830381600087803b1580156104cd57600080fd5b505af11580156104e1573d6000803e3d6000fd5b505050506080830151602084015160608501516040517faae40a2a0000000000000000000000000000000000000000000000000000000081526001600160a01b03928316600482015291166024820152734ddc2d193948926d02f9b1fe9e1daa0718270ed59163aae40a2a916044016000604051808303818588803b15801561056957600080fd5b505af115801561057d573d6000803e3d6000fd5b5050505050610653565b61059a82846040015185608001516116b1565b60408084015160208501516080860151606087015193517ff5e3c4620000000000000000000000000000000000000000000000000000000081526001600160a01b03928316600482015260248101919091529281166044840152169063f5e3c46290606401602060405180830381600087803b15801561061957600080fd5b505af115801561062d573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061065191906131cd565b505b60608301516040517f3af9e6690000000000000000000000000000000000000000000000000000000081523060048201526000916001600160a01b031690633af9e66990602401602060405180830381600087803b1580156106b457600080fd5b505af11580156106c8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106ec91906131cd565b60608501516040517f852a12e3000000000000000000000000000000000000000000000000000000008152600481018390529192506001600160a01b03169063852a12e390602401602060405180830381600087803b15801561074e57600080fd5b505af1158015610762573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061078691906131cd565b508351610795906002906134cb565b156108245760405163a9059cbb60e01b8152336004820152602481018290526001600160a01b0384169063a9059cbb90604401602060405180830381600087803b1580156107e257600080fd5b505af11580156107f6573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061081a91906130b5565b5050505050610a86565b60008061085a735c69bee701ef814a2b6a3edd4b1652cb9cc5aa6f8673c02aaa39b223fe8d0a0e5c4f27ead9083c756cc261174f565b91509150600061086f87608001518385611836565b8751909150610988576108f787606001516001600160a01b0316636f307dc36040518163ffffffff1660e01b815260040160206040518083038186803b1580156108b857600080fd5b505afa1580156108cc573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906108f09190612eb9565b858361196d565b60405163a9059cbb60e01b81523360048201526024810182905273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc29063a9059cbb90604401602060405180830381600087803b15801561094a57600080fd5b505af115801561095e573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061098291906130b5565b50610a7e565b73c02aaa39b223fe8d0a0e5c4f27ead9083c756cc26001600160a01b031663d0e30db0826040518263ffffffff1660e01b81526004016000604051808303818588803b1580156109d757600080fd5b505af11580156109eb573d6000803e3d6000fd5b505060405163a9059cbb60e01b81523360048201526024810185905273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2935063a9059cbb92506044019050602060405180830381600087803b158015610a4457600080fd5b505af1158015610a58573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610a7c91906130b5565b505b505050505050505b5050505050565b6001600160a01b038216610ada57600080546040516001600160a01b039091169183156108fc02918491818181858888f19350505050158015610ad4573d6000803e3d6000fd5b50610b62565b60005460405163a9059cbb60e01b81526001600160a01b039182166004820152602481018390529083169063a9059cbb90604401602060405180830381600087803b158015610b2857600080fd5b505af1158015610b3c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610b6091906130b5565b505b5050565b600354604051633b307a6160e21b81526001600160a01b039091169063ecc1e98490610ba0908d908d908d908d908d908d906004016132b3565b600060405180830381600087803b158015610bba57600080fd5b505af1158015610bce573d6000803e3d6000fd5b50505050610bde8484848461104b565b50505050505050505050565b6000546001600160a01b03163314610c305760405162461bcd60e51b81526020600482015260096024820152682737ba1037bbb732b960b91b6044820152606401610435565b6000546001600160a01b0316ff5b6006547f746d00000000000000000000000000003318585733ff6000526015600bf300003060801b01600052602082045b8015610de25781601e600080f55060018201601e600080f55060028201601e600080f55060038201601e600080f55060048201601e600080f55060058201601e600080f55060068201601e600080f55060078201601e600080f55060088201601e600080f55060098201601e600080f550600a8201601e600080f550600b8201601e600080f550600c8201601e600080f550600d8201601e600080f550600e8201601e600080f550600f8201601e600080f55060108201601e600080f55060118201601e600080f55060128201601e600080f55060138201601e600080f55060148201601e600080f55060158201601e600080f55060168201601e600080f55060178201601e600080f55060188201601e600080f55060198201601e600080f550601a8201601e600080f550601b8201601e600080f550601c8201601e600080f550601d8201601e600080f550601e8201601e600080f550601f8201601e600080f5506020919091019060001901610c6f565b50601f82165b8015610e065781601e600080f5506001919091019060001901610de8565b5060065550565b6000546001600160a01b03163314610e535760405162461bcd60e51b81526020600482015260096024820152682737ba1037bbb732b960b91b6044820152606401610435565b610e5c81611ac3565b50565b60005a9050610e708585858561104b565b61a3db601036025a8361520801030161374a0181610e9e57634e487b7160e01b600052601260045260246000fd5b04905060075460065403811115610eb85750600754600654035b8015610a8657610a8681611cc9565b6000546001600160a01b03163314610f0d5760405162461bcd60e51b81526020600482015260096024820152682737ba1037bbb732b960b91b6044820152606401610435565b6000805473ffffffffffffffffffffffffffffffffffffffff19166001600160a01b0392909216919091179055565b6001600160a01b038116610f5957610f548147610a8d565b610e5c565b6040516370a0823160e01b8152306004820152610e5c9082906001600160a01b038216906370a082319060240160206040518083038186803b158015610f9e57600080fd5b505afa158015610fb2573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061012a91906131cd565b6000546001600160a01b0316331461101c5760405162461bcd60e51b81526020600482015260096024820152682737ba1037bbb732b960b91b6044820152606401610435565b6001805473ffffffffffffffffffffffffffffffffffffffff19166001600160a01b0392909216919091179055565b60055460035460405163fc57d4df60e01b81526001600160a01b03868116600483015260009392169063fc57d4df9060240160206040518083038186803b15801561109557600080fd5b505afa1580156110a9573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906110cd91906131cd565b6110d79190613465565b60035460405163fc57d4df60e01b81526001600160a01b0386811660048301529293506000929091169063fc57d4df9060240160206040518083038186803b15801561112257600080fd5b505afa158015611136573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061115a91906131cd565b600480546040517f95dd91930000000000000000000000000000000000000000000000000000000081526001600160a01b038a811693820193909352929350600092670de0b6b3a7640000928916906395dd91939060240160206040518083038186803b1580156111ca57600080fd5b505afa1580156111de573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061120291906131cd565b61120c9190613465565b6112169190613451565b905060008383876001600160a01b031663182df0f56040518163ffffffff1660e01b815260040160206040518083038186803b15801561125557600080fd5b505afa158015611269573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061128d91906131cd565b6040516370a0823160e01b81526001600160a01b038c811660048301528a16906370a082319060240160206040518083038186803b1580156112ce57600080fd5b505afa1580156112e2573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061130691906131cd565b6113109190613465565b61131a9190613465565b6113249190613451565b90508082106113335780611335565b815b9150670de0b6b3a76400008361134b8685613465565b6113559190613451565b61135f9190613451565b90504793506113718888888585611d71565b925084156114d6578215806113865750826001145b15611466576040516370a0823160e01b815230600482015273c02aaa39b223fe8d0a0e5c4f27ead9083c756cc290632e1a7d4d9082906370a082319060240160206040518083038186803b1580156113dd57600080fd5b505afa1580156113f1573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061141591906131cd565b6040518263ffffffff1660e01b815260040161143391815260200190565b600060405180830381600087803b15801561144d57600080fd5b505af1158015611461573d6000803e3d6000fd5b505050505b6114708447613484565b9150600160009054906101000a90046001600160a01b03166001600160a01b0316631b9265b8836040518263ffffffff1660e01b81526004016000604051808303818588803b1580156114c257600080fd5b505af1158015610a7c573d6000803e3d6000fd5b5050505050505050565b60005a600354604051633b307a6160e21b81529192506001600160a01b03169063ecc1e9849061151e908e908e908e908e908e908e906004016132b3565b600060405180830381600087803b15801561153857600080fd5b505af115801561154c573d6000803e3d6000fd5b5050505061155c8585858561104b565b61a3db601036025a8361520801030161374a018161158a57634e487b7160e01b600052601260045260246000fd5b049050600754600654038111156115a45750600754600654035b80156115b3576115b381611cc9565b5050505050505050505050565b60008060006115cf8585612261565b6040516bffffffffffffffffffffffff19606084811b8216602084015283901b166034820152919350915086906048016040516020818303038152906040528051906020012060405160200161168f9291907fff00000000000000000000000000000000000000000000000000000000000000815260609290921b6bffffffffffffffffffffffff1916600183015260158201527f96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f603582015260550190565b60408051601f1981840301815291905280516020909101209695505050505050565b604051636eb1769f60e11b81523060048201526001600160a01b03838116602483015282919085169063dd62ed3e9060440160206040518083038186803b1580156116fb57600080fd5b505afa15801561170f573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061173391906131cd565b1015610b6057610b606001600160a01b03841683600019612371565b600080600061175e8585612261565b50905060008061176f8888886115c0565b6001600160a01b0316630902f1ac6040518163ffffffff1660e01b815260040160606040518083038186803b1580156117a757600080fd5b505afa1580156117bb573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906117df9190613167565b506dffffffffffffffffffffffffffff1691506dffffffffffffffffffffffffffff169150826001600160a01b0316876001600160a01b031614611824578082611827565b81815b90999098509650505050505050565b60008084116118ad5760405162461bcd60e51b815260206004820152602c60248201527f556e697377617056324c6962726172793a20494e53554646494349454e545f4f60448201527f55545055545f414d4f554e5400000000000000000000000000000000000000006064820152608401610435565b6000831180156118bd5750600082115b61191a5760405162461bcd60e51b815260206004820152602860248201527f556e697377617056324c6962726172793a20494e53554646494349454e545f4c604482015267495155494449545960c01b6064820152608401610435565b60006119268585613465565b611932906103e8613465565b905060006119408685613484565b61194c906103e5613465565b90506119588183613451565b611963906001613439565b9695505050505050565b61198c83737a250d5630b4cf539739df2c5dacb4c659f2488d846116b1565b60408051600280825260608201835260009260208301908036833701905050905083816000815181106119cf57634e487b7160e01b600052603260045260246000fd5b60200260200101906001600160a01b031690816001600160a01b03168152505073c02aaa39b223fe8d0a0e5c4f27ead9083c756cc281600181518110611a2557634e487b7160e01b600052603260045260246000fd5b6001600160a01b03909216602092830291909101909101526040517f5c11d795000000000000000000000000000000000000000000000000000000008152737a250d5630b4cf539739df2c5dacb4c659f2488d90635c11d79590611a959086908690869030904290600401613384565b600060405180830381600087803b158015611aaf57600080fd5b505af11580156114d6573d6000803e3d6000fd5b6002805473ffffffffffffffffffffffffffffffffffffffff19166001600160a01b038316908117909155604080517f7dc0d1d00000000000000000000000000000000000000000000000000000000081529051637dc0d1d091600480820192602092909190829003018186803b158015611b3d57600080fd5b505afa158015611b51573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611b759190612eb9565b6003805473ffffffffffffffffffffffffffffffffffffffff19166001600160a01b03928316179055600254604080517fe87554460000000000000000000000000000000000000000000000000000000081529051919092169163e8755446916004808301926020929190829003018186803b158015611bf457600080fd5b505afa158015611c08573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611c2c91906131cd565b6004908155600254604080517f4ada90af00000000000000000000000000000000000000000000000000000000815290516001600160a01b0390921692634ada90af928282019260209290829003018186803b158015611c8b57600080fd5b505afa158015611c9f573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611cc391906131cd565b60055550565b600754818101806007556040513060581b7fff000000000000000000000000000000000000000000000000000000000000000181526f3318585733ff6000526015600bf300003060801b7f746d00000000000000000000000000000000000000000000000000000000000001016035820152601e60358201206035820152601581015b82841015610a86578381526000806000806000605587205af150600184019350611d4c565b600080848614734ddc2d193948926d02f9b1fe9e1daa0718270ed5861460020201734ddc2d193948926d02f9b1fe9e1daa0718270ed587146003020190506000806000806000611dc2868c8c6124ec565b9450945094509450945082881115611e045787611ddf848b613465565b611de99190613451565b89611df4858b613465565b611dfe9190613451565b90995097505b60408051602081018890526001600160a01b038e8116828401528d811660608301528c16608082015260a08082018c90528251808303909101815260c0909101909152611e526002886134cb565b611fb557846001600160a01b0316866001600160a01b0316630dfe16816040518163ffffffff1660e01b815260040160206040518083038186803b158015611e9957600080fd5b505afa158015611ead573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611ed19190612eb9565b6001600160a01b03161415611f4a5760405163022c0d9f60e01b81526001600160a01b0387169063022c0d9f90611f13908d9060009030908790600401613343565b600060405180830381600087803b158015611f2d57600080fd5b505af1158015611f41573d6000803e3d6000fd5b50505050611fb0565b60405163022c0d9f60e01b81526001600160a01b0387169063022c0d9f90611f7d906000908e9030908790600401613343565b600060405180830381600087803b158015611f9757600080fd5b505af1158015611fab573d6000803e3d6000fd5b505050505b612250565b866001141561210657886103e50293506103e86103e7858c85036103e802018c6103e8028703860281611ff857634e487b7160e01b600052601260045260246000fd5b04028161201557634e487b7160e01b600052601260045260246000fd5b049350846001600160a01b0316866001600160a01b0316630dfe16816040518163ffffffff1660e01b815260040160206040518083038186803b15801561205b57600080fd5b505afa15801561206f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906120939190612eb9565b6001600160a01b031614156120d45760405163022c0d9f60e01b81526001600160a01b0387169063022c0d9f90611f13908d90889030908790600401613343565b60405163022c0d9f60e01b81526001600160a01b0387169063022c0d9f90611f7d9087908e9030908790600401613343565b6103e86103e76121178b86866127d3565b6121219190613465565b61212b9190613451565b9350846001600160a01b0316866001600160a01b0316630dfe16816040518163ffffffff1660e01b815260040160206040518083038186803b15801561217057600080fd5b505afa158015612184573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906121a89190612eb9565b6001600160a01b031614156121ea5760405163022c0d9f60e01b81526001600160a01b0387169063022c0d9f90611f7d90879060009030908790600401613343565b60405163022c0d9f60e01b81526001600160a01b0387169063022c0d9f9061221d90600090889030908790600401613343565b600060405180830381600087803b15801561223757600080fd5b505af115801561224b573d6000803e3d6000fd5b505050505b50949b9a5050505050505050505050565b600080826001600160a01b0316846001600160a01b031614156122ec5760405162461bcd60e51b815260206004820152602560248201527f556e697377617056324c6962726172793a204944454e544943414c5f4144445260448201527f45535345530000000000000000000000000000000000000000000000000000006064820152608401610435565b826001600160a01b0316846001600160a01b03161061230c57828461230f565b83835b90925090506001600160a01b03821661236a5760405162461bcd60e51b815260206004820152601e60248201527f556e697377617056324c6962726172793a205a45524f5f4144445245535300006044820152606401610435565b9250929050565b8015806123fa5750604051636eb1769f60e11b81523060048201526001600160a01b03838116602483015284169063dd62ed3e9060440160206040518083038186803b1580156123c057600080fd5b505afa1580156123d4573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906123f891906131cd565b155b61246c5760405162461bcd60e51b815260206004820152603660248201527f5361666545524332303a20617070726f76652066726f6d206e6f6e2d7a65726f60448201527f20746f206e6f6e2d7a65726f20616c6c6f77616e6365000000000000000000006064820152608401610435565b604080516001600160a01b038416602482015260448082018490528251808303909101815260649091019091526020810180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167f095ea7b300000000000000000000000000000000000000000000000000000000179052610b60908490612905565b600080808080808861267057876001600160a01b0316636f307dc36040518163ffffffff1660e01b815260040160206040518083038186803b15801561253157600080fd5b505afa158015612545573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906125699190612eb9565b9450866001600160a01b0316636f307dc36040518163ffffffff1660e01b815260040160206040518083038186803b1580156125a457600080fd5b505afa1580156125b8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906125dc9190612eb9565b90506000612613735c69bee701ef814a2b6a3edd4b1652cb9cc5aa6f8773c02aaa39b223fe8d0a0e5c4f27ead9083c756cc26129ea565b9850915061264c9050735c69bee701ef814a2b6a3edd4b1652cb9cc5aa6f73c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2846129ea565b509450925061265f6103b6858584612bc2565b9450600093508392506127c8915050565b88600314156127085773c02aaa39b223fe8d0a0e5c4f27ead9083c756cc29450866001600160a01b0316636f307dc36040518163ffffffff1660e01b815260040160206040518083038186803b1580156126c957600080fd5b505afa1580156126dd573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906127019190612eb9565b9050612793565b876001600160a01b0316636f307dc36040518163ffffffff1660e01b815260040160206040518083038186803b15801561274157600080fd5b505afa158015612755573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906127799190612eb9565b945073c02aaa39b223fe8d0a0e5c4f27ead9083c756cc290505b6127b2735c69bee701ef814a2b6a3edd4b1652cb9cc5aa6f86836129ea565b9750935091506127c46103b684612c48565b9350505b939792965093509350565b600080841161284a5760405162461bcd60e51b815260206004820152602b60248201527f556e697377617056324c6962726172793a20494e53554646494349454e545f4960448201527f4e5055545f414d4f554e540000000000000000000000000000000000000000006064820152608401610435565b60008311801561285a5750600082115b6128b75760405162461bcd60e51b815260206004820152602860248201527f556e697377617056324c6962726172793a20494e53554646494349454e545f4c604482015267495155494449545960c01b6064820152608401610435565b60006128c5856103e5613465565b905060006128d38483613465565b90506000826128e4876103e8613465565b6128ee9190613439565b90506128fa8183613451565b979650505050505050565b600061295a826040518060400160405280602081526020017f5361666545524332303a206c6f772d6c6576656c2063616c6c206661696c6564815250856001600160a01b0316612c9a9092919063ffffffff16565b805190915015610b60578080602001905181019061297891906130b5565b610b605760405162461bcd60e51b815260206004820152602a60248201527f5361666545524332303a204552433230206f7065726174696f6e20646964206e60448201527f6f742073756363656564000000000000000000000000000000000000000000006064820152608401610435565b60008060008060006129fc8787612261565b6040516bffffffffffffffffffffffff19606084811b8216602084015283901b1660348201529193509150889060480160405160208183030381529060405280519060200120604051602001612abc9291907fff00000000000000000000000000000000000000000000000000000000000000815260609290921b6bffffffffffffffffffffffff1916600183015260158201527f96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f603582015260550190565b60408051601f1981840301815291905280516020909101209250823b63ffffffff8116612af25760008095509550505050612bb9565b600080856001600160a01b0316630902f1ac6040518163ffffffff1660e01b815260040160606040518083038186803b158015612b2e57600080fd5b505afa158015612b42573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190612b669190613167565b506dffffffffffffffffffffffffffff1691506dffffffffffffffffffffffffffff169150846001600160a01b03168a6001600160a01b031614612bab578082612bae565b81815b909850965050505050505b93509350939050565b600080826103e802846103e5020183866103e5020281612bf257634e487b7160e01b600052601260045260246000fd5b049050620186a0620188fb876305f5e10081612c1e57634e487b7160e01b600052601260045260246000fd5b0403820281612c3d57634e487b7160e01b600052601260045260246000fd5b049695505050505050565b6000620186a0620187cd846305f5e10081612c7357634e487b7160e01b600052601260045260246000fd5b0403830281612c9257634e487b7160e01b600052601260045260246000fd5b049392505050565b6060612ca98484600085612cb3565b90505b9392505050565b606082471015612d2b5760405162461bcd60e51b815260206004820152602660248201527f416464726573733a20696e73756666696369656e742062616c616e636520666f60448201527f722063616c6c00000000000000000000000000000000000000000000000000006064820152608401610435565b612d3485612dee565b612d805760405162461bcd60e51b815260206004820152601d60248201527f416464726573733a2063616c6c20746f206e6f6e2d636f6e74726163740000006044820152606401610435565b600080866001600160a01b03168587604051612d9c9190613297565b60006040518083038185875af1925050503d8060008114612dd9576040519150601f19603f3d011682016040523d82523d6000602084013e612dde565b606091505b50915091506128fa828286612df8565b803b15155b919050565b60608315612e07575081612cac565b825115612e175782518084602001fd5b8160405162461bcd60e51b81526004016104359190613371565b8035612df38161350b565b60008083601f840112612e4d578182fd5b50813567ffffffffffffffff811115612e64578182fd5b6020830191508360208260051b850101111561236a57600080fd5b80516dffffffffffffffffffffffffffff81168114612df357600080fd5b600060208284031215612eae578081fd5b8135612cac8161350b565b600060208284031215612eca578081fd5b8151612cac8161350b565b60008060008060808587031215612eea578283fd5b8435612ef58161350b565b93506020850135612f058161350b565b92506040850135612f158161350b565b9396929550929360600135925050565b60008060408385031215612f37578182fd5b8235612f428161350b565b946020939093013593505050565b600080600080600060808688031215612f67578081fd5b8535612f728161350b565b94506020860135935060408601359250606086013567ffffffffffffffff80821115612f9c578283fd5b818801915088601f830112612faf578283fd5b813581811115612fbd578384fd5b896020828501011115612fce578384fd5b9699959850939650602001949392505050565b60008060008060008060008060008060e08b8d031215612fff578485fd5b8a3567ffffffffffffffff80821115613016578687fd5b6130228e838f01612e3c565b909c509a5060208d013591508082111561303a578687fd5b6130468e838f01612e3c565b909a50985060408d013591508082111561305e578687fd5b5061306b8d828e01612e3c565b90975095505060608b013561307f8161350b565b935060808b013561308f8161350b565b925061309d60a08c01612e31565b915060c08b013590509295989b9194979a5092959850565b6000602082840312156130c6578081fd5b81518015158114612cac578182fd5b600060a082840312156130e6578081fd5b60405160a0810181811067ffffffffffffffff8211171561311557634e487b7160e01b83526041600452602483fd5b60405282358152602083013561312a8161350b565b6020820152604083013561313d8161350b565b604082015261314e60608401612e31565b6060820152608083013560808201528091505092915050565b60008060006060848603121561317b578081fd5b61318484612e7f565b925061319260208501612e7f565b9150604084015163ffffffff811681146131aa578182fd5b809150509250925092565b6000602082840312156131c6578081fd5b5035919050565b6000602082840312156131de578081fd5b5051919050565b60008284526020808501808196508560051b8101915084845b8781101561323457828403895261321582886133f4565b613220868284613241565b9a87019a95505050908401906001016131fe565b5091979650505050505050565b60008284528282602086013780602084860101526020601f19601f85011685010190509392505050565b6000815180845261328381602086016020860161349b565b601f01601f19169290920160200192915050565b600082516132a981846020870161349b565b9190910192915050565b6000606082526132c760608301888a6131e5565b6020838203818501526132db82888a6131e5565b84810360408601528581529150808201600586901b8301820187855b8881101561333157858303601f19018452613312828b6133f4565b61331d858284613241565b9587019594505050908401906001016132f7565b50909c9b505050505050505050505050565b60008582528460208301526001600160a01b038416604083015260806060830152611963608083018461326b565b600060208252612cac602083018461326b565b600060a082018783526020878185015260a0604085015281875180845260c0860191508289019350845b818110156133d35784516001600160a01b0316835293830193918301916001016133ae565b50506001600160a01b03969096166060850152505050608001529392505050565b6000808335601e1984360301811261340a578283fd5b830160208101925035905067ffffffffffffffff81111561342a57600080fd5b80360383131561236a57600080fd5b6000821982111561344c5761344c6134df565b500190565b600082613460576134606134f5565b500490565b600081600019048311821515161561347f5761347f6134df565b500290565b600082821015613496576134966134df565b500390565b60005b838110156134b657818101518382015260200161349e565b838111156134c5576000848401525b50505050565b6000826134da576134da6134f5565b500690565b634e487b7160e01b600052601160045260246000fd5b634e487b7160e01b600052601260045260246000fd5b6001600160a01b0381168114610e5c57600080fdfea26469706673582212202ad75ede77e0b18e189cd548f7d1f2c737948a7f88fe50c71cb539284af7ca4464736f6c63430008030033";
const SALT =
  "0x0e5ed78b0209f397fc1f682b9a7aa86012920f68f1b8bcffd628cb04d4b3cf0a";
const ADDR = "0x000000000009fd1fb8cab395c5c716defcb644ec";

describe("Deployer Contract Test", function () {
  let accounts;
  let deployer;
  let liquidator;

  before(async function () {
    accounts = await web3.eth.getAccounts();
  });

  describe("Deploy Deployer @latest-block", function () {
    it("should deploy from vanity address", async () => {
      expect(accounts[0]).to.equal(
        "0xC97a4D9598be6e95495fA2f153F7F30F53E29ea2"
      );
    });

    it("should deploy to expected address", async () => {
      deployer = await Deployer.new();
      expect(deployer.address).to.equal(
        "0x000000000E5C7CEEEaB9157df8f0FbDA823f1057"
      );
    });
  });

  describe("Use Deployer @latest-block", function () {
    it("should deploy liquidator to expected address", async () => {
      let tx = await deployer.deploy(BYTECODE, SALT, 30);
      expect(tx.receipt.status).to.be.true;

      liquidator = await Liquidator.at(ADDR);
      tx = await liquidator.payoutMax(
        "0x0000000000000000000000000000000000000000"
      );
      expect(tx.receipt.status).to.be.true;
    });

    it("should liquidate someone", async () => {
      const tx = await liquidator.liquidateS(
        "0xfee8b4cff7e818f3b7ecb538be9466d50d8a0f3c",
        "0xb3319f5d18bc0d84dd1b4825dcde5d5f7266d407",
        "0x5d3a536e4d6dbd6114cc1ead35777bab948e3643",
        6000
      );
      expect(tx.receipt.status).to.be.true;

      const events = tx.receipt.rawLogs;
      expect(events.length).to.equal(25);

      console.log(`Gas used in liquidation: ${tx.receipt.gasUsed}`);
    });

    it("should mint pseudo-chi", async () => {
      const tx = await liquidator.mintCHI(50);
      expect(tx.receipt.status).to.be.true;

      console.log(`Gas used to mint pseudo-chi: ${tx.receipt.gasUsed}`);
    });

    it("should use pseudo-chi to reduce gas", async () => {
      const args = {
        borrower: "0x4979a6ecf96e9ffed983c76399076fb113d2d82a",
        repay: "0x6c8c6b02e7b2be14d4fa6022dfd6d75921d90e4e",
        seize: "0x39aa39c021dfbae8fac545936693ac917d5e7563",
        toMiner: 6000,
      };

      const gas = await liquidator.liquidateSChi.estimateGas(
        args.borrower,
        args.repay,
        args.seize,
        args.toMiner
      );

      const tx = await liquidator.liquidateSChi(
        args.borrower,
        args.repay,
        args.seize,
        args.toMiner
      );
      expect(tx.receipt.status).to.be.true;

      expect(Math.floor(gas / tx.receipt.gasUsed)).to.equal(2);
    });
  });
});
